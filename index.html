<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nomad Go | Happy New Year ‚ùÑÔ∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;900&display=swap');
        body { font-family: 'Montserrat', sans-serif; background: #011420; color: #1e293b; margin: 0; overflow-x: hidden; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–µ–ª–∫–∏—Ö —Å–º–∞–π–ª–∏–∫–æ–≤ –Ω–∞ —Ñ–æ–Ω–µ */
        #snow-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .tiny-emoji { position: absolute; opacity: 0.15; animation: float-around 15s infinite ease-in-out; user-select: none; }
        @keyframes float-around { 0%, 100% { transform: translate(0, 0) rotate(0deg); } 33% { transform: translate(15px, -20px) rotate(10deg); } 66% { transform: translate(-10px, 10px) rotate(-10deg); } }

        /* –°–≤–µ—Ç–ª–∞—è –∫–∞—Ä—Ç–∞ —Å –Ω–æ–≤–æ–≥–æ–¥–Ω–µ–π —Ä–∞–º–∫–æ–π */
        #map { height: 450px; width: 100%; border-radius: 30px; border: 6px solid #fff; background: #e2e8f0; box-shadow: 0 10px 40px rgba(59, 130, 246, 0.2); position: relative; z-index: 10; }
        .glass-card { background: rgba(255, 255, 255, 0.952); backdrop-filter: blur(15px); border: 1px solid rgba(1, 2, 31, 0.8); border-radius: 2rem; box-shadow: 0 10px 30px rgba(0,0,0,0.05); position: relative; z-index: 10; }
        .cat-btn { transition: 0.3s; opacity: 0.7; cursor: pointer; font-size: 9px; font-weight: 900; text-transform: uppercase; padding: 10px; border-radius: 12px; color: rgb(255, 255, 255); }
        .cat-btn.active { opacity: 1; border: 2px solid #1e293b; transform: scale(1.05); }
        .btn-main { background: linear-gradient(45deg, #3b82f6, #1d4ed8); box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3); color: white; }
        .map-label { color: #1e293b; padding: 4px 10px; border-radius: 10px; font-weight: 900; font-size: 10px; border: 2px solid #1e293b; background: white; white-space: nowrap; }
        .user-dot { width: 20px; height: 20px; background: #ef4444; border: 3px solid white; border-radius: 50%; box-shadow: 0 0 15px rgba(239, 68, 68, 0.5); position: relative; }
        .leaflet-control-attribution, .leaflet-routing-container { display: none !important; }
        h1 { background: linear-gradient(to bottom, #fff 20%, #3b82f6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; position: relative; z-index: 10; }
    </style>
</head>
<body class="p-4 md:p-6">

    <div id="snow-container"></div>

    <div class="max-w-7xl mx-auto relative z-10">
        <header class="text-center mb-6">
            <h1 class="text-4xl font-black italic uppercase tracking-tight">
                Neo Nomad‚ùÑ
            </h1>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-4 space-y-4">
                <div class="glass-card p-6 shadow-2xl border-t-4 border-blue-400">
                    <div class="space-y-4">
                        <div class="relative">
                            <label class="text-[10px] font-black uppercase text-gray-400 ml-1">–°—Ç–∞—Ä—Ç:</label>
                            <input id="startInput" type="text" class="w-full p-4 bg-white/50 border border-blue-100 rounded-2xl outline-none text-sm text-slate-800" placeholder="–û—Ç–∫—É–¥–∞?">
                            <button id="gpsBtn" onclick="toggleGPS()" class="absolute right-2 top-8 bg-blue-500 p-2 rounded-xl text-white">üõ∞Ô∏è</button>
                        </div>
                        <div>
                            <label class="text-[10px] font-black uppercase text-gray-400 ml-1">–§–∏–Ω–∏—à:</label>
                            <input id="endInput" type="text" class="w-full p-4 bg-white/50 border border-blue-100 rounded-2xl outline-none text-sm text-slate-800" placeholder="–ö—É–¥–∞ –µ–¥–µ–º?">
                        </div>
                    </div>

                    <div class="mt-6 grid grid-cols-3 gap-2">
                        <button onclick="toggleCat('tourism', '–ì–ò–î', '#3b82f6', this)" class="cat-btn active bg-blue-500">üèõÔ∏è –ì–∏–¥</button>
                        <button onclick="toggleCat('hotel', '–°–û–ù', '#a855f7', this)" class="cat-btn bg-purple-500">üè® –°–æ–Ω</button>
                        <button onclick="toggleCat('park', '–ü–ê–†–ö', '#22c55e', this)" class="cat-btn bg-green-500">üå≥ –ü–∞—Ä–∫</button>
                        <button onclick="toggleCat('hospital', 'SOS', '#10b981', this)" class="cat-btn bg-emerald-500">üè• SOS</button>
                        <button onclick="toggleCat('police', '–ö–û–ü–´', '#1e40af', this)" class="cat-btn bg-blue-800">üëÆ –ö–æ–ø—ã</button> 
                        <button onclick="toggleCat('restaurant', '–ï–î–ê', '#ef4444', this)" class="cat-btn bg-red-600">üç± –ï–¥–∞</button>
                        <button onclick="toggleCat('bus_stop', '–ê–í–¢–û', '#64748b', this)" class="cat-btn bg-slate-500">üöå –ê–≤—Ç–æ</button>
                    </div>

                    <button id="goBtn" onclick="buildRoadRoute()" class="btn-main w-full mt-6 p-5 rounded-2xl font-black text-xl uppercase italic shadow-xl transition-all active:scale-95">
                        –ü–†–û–õ–û–ñ–ò–¢–¨ –ü–£–¢–¨ üöÄ
                    </button>
                </div>

                <div id="list-card" class="glass-card p-6 hidden max-h-[150px] overflow-y-auto">
                    <h3 class="text-xs font-black uppercase text-blue-500 mb-3 tracking-widest">–ú–µ—Å—Ç–∞ –ø–æ –ø—É—Ç–∏:</h3>
                    <div id="res-list" class="space-y-2 text-[11px] font-bold border-l border-blue-200 pl-4 text-slate-700"></div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-4">
                <div id="map"></div>

                <div id="stats-panel" class="glass-card p-6 hidden flex justify-around items-center border-b-4 border-blue-400">
                    <div class="text-center">
                        <p class="text-[10px] font-black text-gray-400 uppercase">–î–∏—Å—Ç–∞–Ω—Ü–∏—è</p>
                        <p id="route-dist" class="text-3xl font-black text-slate-800 italic">0.0 –∫–º</p>
                    </div>
                    <div class="text-center">
                        <p class="text-[10px] font-black text-gray-400 uppercase">–í—Ä–µ–º—è</p>
                        <p id="route-time" class="text-3xl font-black text-blue-600 italic">0 –º–∏–Ω</p>
                    </div>
                    <button onclick="orderTaxi()" class="bg-yellow-400 text-black px-6 py-3 rounded-2xl font-black uppercase text-xs flex items-center gap-2 hover:scale-105 transition-all shadow-md">
                        –ó–∞–∫–∞–∑–∞—Ç—å —Ç–∞–∫—Å–∏ üöï
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ï–ù–ï–†–ê–¶–ò–Ø –°–ú–ê–ô–õ–ò–ö–û–í –ù–ê –§–û–ù–ï
        const emojis = ['üéÑ', 'üç™', '‚õÑ', 'üéÖ', 'üéÅ', '‚ùÑÔ∏è'];
        const snowContainer = document.getElementById('snow-container');
        for (let i = 0; i < 50; i++) {
            const span = document.createElement('span');
            span.className = 'tiny-emoji';
            span.innerText = emojis[Math.floor(Math.random() * emojis.length)];
            span.style.left = Math.random() * 100 + 'vw';
            span.style.top = Math.random() * 100 + 'vh';
            span.style.fontSize = (Math.random() * 15 + 10) + 'px';
            span.style.animationDelay = Math.random() * 10 + 's';
            snowContainer.appendChild(span);
        }

        let map, routingControl, markers = [], userMarker, watchID = null;
        let startCoords = null, endCoords = null;
        let selectedCats = [{type:'tourism', label:'–ì–ò–î', color:'#3b82f6'}];

        function initMap() {
            map = L.map('map', { zoomControl: false, attributionControl: false }).setView([42.87, 74.59], 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
        }

        function toggleGPS() {
    const btn = document.getElementById('gpsBtn');
    const input = document.getElementById('startInput');
    
    // –ü–ï–†–°–û–ù–ê–ñ–ò –° –§–û–¢–û–ì–†–ê–§–ò–Ø–ú–ò
    const homeAloneHeroes = [
        { 
            name: '–ö–µ–≤–∏–Ω', 
            img: 'kevin.jpg' 
        },
        { 
            name: '–ì–∞—Ä—Ä–∏', 
            img: 'garry.jpg' 
        },
        { 
            name: '–ú–∞—Ä–≤', 
            img: 'marv.jpg' 
        },
        {
            name:'–û–ª–∞—Ñ',
            img:'–æ–ª–∞—Ñ.jpg'
        },
        {
            name:'–°–∞–Ω—Ç–∞',
            img:'santa.jpg'
        },
        
         
    ];
    
    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≥–µ—Ä–æ—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤–∫–ª—é—á–µ–Ω–∏–∏
    const hero = homeAloneHeroes[Math.floor(Math.random() * homeAloneHeroes.length)];

    if (watchID) {
        // –í–´–ö–õ–Æ–ß–ï–ù–ò–ï
        navigator.geolocation.clearWatch(watchID); 
        watchID = null;
        btn.classList.replace('bg-blue-600', 'bg-blue-500'); 
        input.value = "";
        startCoords = null;
        if (userMarker) map.removeLayer(userMarker);
        userMarker = null;
    } else {
        // –í–ö–õ–Æ–ß–ï–ù–ò–ï
        btn.classList.replace('bg-blue-500', 'bg-blue-600'); 
        input.value = "üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ";
        
        watchID = navigator.geolocation.watchPosition(pos => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            startCoords = { lat, lon };
            
            // HTML –∫–æ–¥ –¥–ª—è –º–∞—Ä–∫–µ—Ä–∞ —Å —Ñ–æ—Ç–æ
            const markerHtml = `
                <div class="avatar-container" style="position: relative;">
                    <div class="user-avatar-img" style="background-image: url('${hero.img}');">
                        <div class="char-name-tag">${hero.name}</div>
                    </div>
                </div>`;
            
            if (!userMarker) {
                userMarker = L.marker([lat, lon], { 
                    icon: L.divIcon({ 
                        className: 'custom-photo-marker', 
                        html: markerHtml,
                        iconSize: [60, 60],
                        iconAnchor: [30, 30]
                    }) 
                }).addTo(map);
                map.setView([lat, lon], 15);
            } else { 
                userMarker.setLatLng([lat, lon]);
            }
        }, null, { enableHighAccuracy: true });
    }
}
        function toggleCat(type, label, color, btn) {
            const index = selectedCats.findIndex(c => c.type === type);
            if (index > -1) { selectedCats.splice(index, 1); btn.classList.remove('active'); }
            else { selectedCats.push({ type, label, color }); btn.classList.add('active'); }
        }

        async function getLatLon(query) {
            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
            const data = await res.json();
            return data.length ? { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon) } : null;
        }

        async function buildRoadRoute() {
            const btn = document.getElementById('goBtn'); btn.innerText = "–°–¢–†–û–ò–ú... ‚ú®";
            const startVal = document.getElementById('startInput').value;
            const endVal = document.getElementById('endInput').value;

            if (routingControl) map.removeControl(routingControl);
            markers.forEach(m => map.removeLayer(m)); markers = [];
            document.getElementById('res-list').innerHTML = "";

            let waypoints = [];

            // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê: –ï—Å–ª–∏ GPS –≤–∫–ª—é—á–µ–Ω, –±–µ—Ä–µ–º –µ–≥–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞–ø—Ä—è–º—É—é
            let finalStart = null;
            if (watchID && startCoords) {
                finalStart = L.latLng(startCoords.lat, startCoords.lon);
            } else {
                const resStart = await getLatLon(startVal || "–ë–∏—à–∫–µ–∫");
                if (resStart) finalStart = L.latLng(resStart.lat, resStart.lon);
            }

            if (finalStart) waypoints.push(finalStart);

            // –ü–æ–∏—Å–∫ —Ç–æ—á–µ–∫ –ø–æ –ø—É—Ç–∏
            const basePoint = finalStart || {lat: 42.87, lng: 74.59};
            for (let cat of selectedCats) {
                const delta = 0.05;
                const url = `https://nominatim.openstreetmap.org/search?format=json&q=${cat.type}&viewbox=${basePoint.lng-delta},${basePoint.lat+delta},${basePoint.lng+delta},${basePoint.lat-delta}&bounded=1&limit=3`;
                try {
                    const poiData = await (await fetch(url)).json();
                    poiData.forEach(p => {
                        const lat = parseFloat(p.lat), lon = parseFloat(p.lon);
                        waypoints.push(L.latLng(lat, lon));
                        const m = L.marker([lat, lon], {
                            icon: L.divIcon({ className: 'label', html: `<div class="map-label" style="border-color:${cat.color}">${cat.label}</div>` })
                        }).addTo(map);
                        markers.push(m);
                        document.getElementById('res-list').innerHTML += `<div><span style="color:${cat.color}">‚óè</span> ${p.display_name.split(',')[0]}</div>`;
                    });
                } catch(e) {}
            }

            if (endVal) {
                endCoords = await getLatLon(endVal);
                if (endCoords) {
                    waypoints.push(L.latLng(endCoords.lat, endCoords.lon));
                    markers.push(L.marker([endCoords.lat, endCoords.lon], { icon: L.divIcon({ className: 'label', html: `<div class="map-label" style="background:#ef4444; color:white">–§–ò–ù–ò–® üèÅ</div>` }) }).addTo(map));
                }
            }

            if (waypoints.length > 1) {
                routingControl = L.Routing.control({
                    waypoints: waypoints,
                    lineOptions: { styles: [{ color: '#3b82f6', opacity: 0.7, weight: 6 }] },
                    createMarker: () => null,
                    addWaypoints: false
                }).on('routesfound', function(e) {
                    const s = e.routes[0].summary;
                    document.getElementById('stats-panel').classList.remove('hidden');
                    document.getElementById('route-dist').innerText = (s.totalDistance / 1000).toFixed(1) + " –∫–º";
                    document.getElementById('route-time').innerText = Math.round(s.totalTime / 60) + " –º–∏–Ω";
                }).addTo(map);
            }

            document.getElementById('list-card').classList.toggle('hidden', markers.length === 0);
            btn.innerText = "–ü–£–¢–¨ –ì–û–¢–û–í! üèéÔ∏è";
        }

        function orderTaxi() {
            if (!endCoords) return alert("–£–∫–∞–∂–∏—Ç–µ –§–∏–Ω–∏—à!");
            const lat = endCoords.lat, lon = endCoords.lon;
            const destName = encodeURIComponent(document.getElementById('endInput').value || "–§–∏–Ω–∏—à");
            const isCIS = confirm("–í—ã –≤ –°–ù–ì? (OK - –Ø–Ω–¥–µ–∫—Å Go, –û—Ç–º–µ–Ω–∞ - Uber)");
            if (isCIS) {
                window.open(`https://3.redirect.appmetrica.yandex.com/route?end-lat=${lat}&end-lon=${lon}&text=${destName}&ref=nomadgo&appmetrica_tracking_id=1178268795219780156`, '_blank');
            } else {
                window.open(`https://m.uber.com/ul/?action=setPickup&dropoff[latitude]=${lat}&dropoff[longitude]=${lon}&dropoff[nickname]=${destName}`, '_blank');
            }
        }

        window.onload = initMap;
    </script>

    <style>
    .user-avatar-img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: 3px solid #ef4444;
    background-size: cover;
    background-position: center;
    box-shadow: 0 0 20px rgba(239, 68, 68, 0.8);
    position: relative;
    transition: transform 0.3s;
}

/* –ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ–¥ —Ñ–æ—Ç–æ */
.char-name-tag {
    position: absolute;
    bottom: -15px;
    left: 50%;
    transform: translateX(-50%);
    background: #ef4444;
    color: white;
    font-size: 9px;
    padding: 2px 8px;
    border-radius: 10px;
    font-weight: 900;
    white-space: nowrap;
    text-shadow: 1px 1px 2px black;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –ø—É–ª—å—Å–∞—Ü–∏–∏ –≤–æ–∫—Ä—É–≥ —Ñ–æ—Ç–æ */
.avatar-container::before {
    content: '';
    position: absolute;
    top: -5px; left: -5px; right: -5px; bottom: -5px;
    border-radius: 50%;
    border: 2px solid #3b82f6;
    animation: pulse-ring 1.5s infinite;
}

@keyframes pulse-ring {
    0% { transform: scale(0.9); opacity: 1; }
    100% { transform: scale(1.4); opacity: 0; }
}


    </style>
</body>

</html>